<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: likes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: likes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import pool from './database.js';

/**
 * @module likes
 */

/** Ajoute un like à un plat pour un utilisateur.
* @async
* @param {number} mealId - Identifiant du plat.
* @param {string} userId - Identifiant de l'utilisateur.
* @returns {Promise&lt;Object|null>} Résultat de l'opération ou null si échec.
*/
async function addLikeToMeal(mealId, userId) {
    // Vérifier si le plat existe
    const [mealExists] = await pool.query(`
        SELECT * FROM meals WHERE mealId = ?
    `, [mealId]);

    if (mealExists.length === 0) {
        console.log("Plat introuvable");
        return null;
    }

    // Vérifier si l'utilisateur existe
    const [userExists] = await pool.query(`
        SELECT * FROM user WHERE id = ?
    `, [userId]);

    if (userExists.length === 0) {
        console.log("Utilisateur introuvable");
        return null;
    }

    // Ajouter un like dans la table mealLikes (si elle existe)
    const [alreadyLiked] = await pool.query(`
        SELECT * FROM likes WHERE mealId = ? AND userId = ?
    `, [mealId, userId]);

    if (alreadyLiked.length > 0) {
        console.log("Vous avez déjà liké ce plat");
        return null;
    }

    await pool.query(`
        INSERT INTO likes (mealId, userId)
        VALUES (?, ?)
    `, [mealId, userId]);
    console.log("Like ajouté dans la table mealLikes");

    // Mettre à jour le compteur de likes dans la table meals
    await pool.query(`
        UPDATE meals
        SET likes = likes + 1
        WHERE mealId = ?
    `, [mealId]);
    
    console.log("Compteur de likes mis à jour pour le plat");
    
    return { success: true, message: "Like ajouté avec succès" };
}

/**
 * Retire un like d'un plat pour un utilisateur.
 * @async
 * @param {number} mealId - Identifiant du plat.
 * @param {string} userId - Identifiant de l'utilisateur.
 * @returns {Promise&lt;Object|null>} Résultat de l'opération ou null si échec.
 */
async function removeLikeFromMeal(mealId, userId) {
    // Vérifier si le plat existe
    const [mealExists] = await pool.query(`
        SELECT * FROM meals WHERE mealId = ?
    `, [mealId]);

    if (mealExists.length === 0) {
        console.log("Plat introuvable");
        return null;
    }

    // Vérifier si l'utilisateur a liké ce plat
    const [alreadyLiked] = await pool.query(`
        SELECT * FROM likes WHERE mealId = ? AND userId = ?
    `, [mealId, userId]);

    if (alreadyLiked.length === 0) {
        console.log("Vous n'avez pas liké ce plat");
        return null;
    }

    // Supprimer le like de la table mealLikes
    await pool.query(`
        DELETE FROM likes WHERE mealId = ? AND userId = ?
    `, [mealId, userId]);
    console.log("Like supprimé de la table mealLikes");

    // Décrémenter le compteur de likes dans la table meals
    await pool.query(`
        UPDATE meals
        SET likes = likes - 1
        WHERE mealId = ?
    `, [mealId]);
    
    console.log("Compteur de likes décrémenté pour le plat");
    
    return { success: true, message: "Like retiré avec succès" };
}


/*  Exemple d'utilisation
async function main() {
    const result = await addLikeToMeal(1, "paul.emptoz@telecom-sudparis.eu");
    
    if (result) {
        console.log(result.message);
    } else {
        console.log("Le like n'a pas pu être ajouté.");
    }

    
    const result2 = await removeLikeFromMeal(1, "paul.emptoz@telecom-sudparis.eu");
    
    if (result2) {
        console.log(result2.message);
    } else {
        console.log("Le like n'a pas pu être retiré.");
    }
    
    pool.end(); // Fermer le pool de connexions
}

main();
*/
</code></pre>
        </article>
    </section>




</div>

<nav>

    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-likes.html">likes</a></li></ul>

</nav>

<br class="clear">

<footer>

    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon May 12 2025 21:07:30 GMT+0200 (heure d’été d’Europe centrale)

</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
